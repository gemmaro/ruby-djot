!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.djot=e():t.djot=e()}(this,(()=>(()=>{"use strict";var t={60:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isCaption=e.isRow=e.isBlock=e.isInline=void 0;const s={para:!0,heading:!0,thematic_break:!0,section:!0,div:!0,code_block:!0,raw_block:!0,list:!0,table:!0,reference:!0,footnote:!0};e.isBlock=function(t){return s[t.tag]||!1};const n={str:!0,softbreak:!0,hardbreak:!0,nbsp:!0,symb:!0,verbatim:!0,raw_inline:!0,math:!0,url:!0,email:!0,footnote_reference:!0,left_single_quote:!0,right_single_quote:!0,left_double_quote:!0,right_double_quote:!0,ellipses:!0,em_dash:!0,en_dash:!0,emph:!0,strong:!0,link:!0,image:!0,span:!0,mark:!0,superscript:!0,subscript:!0,insert:!0,delete:!0,double_quoted:!0,single_quoted:!0};e.isInline=function(t){return n[t.tag]||!1},e.isRow=function(t){return"head"in t},e.isCaption=function(t){return!("head"in t)}},722:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeParser=void 0,function(t){t[t.SCANNING=0]="SCANNING",t[t.SCANNING_ID=1]="SCANNING_ID",t[t.SCANNING_CLASS=2]="SCANNING_CLASS",t[t.SCANNING_KEY=3]="SCANNING_KEY",t[t.SCANNING_VALUE=4]="SCANNING_VALUE",t[t.SCANNING_BARE_VALUE=5]="SCANNING_BARE_VALUE",t[t.SCANNING_QUOTED_VALUE=6]="SCANNING_QUOTED_VALUE",t[t.SCANNING_QUOTED_VALUE_CONTINUATION=7]="SCANNING_QUOTED_VALUE_CONTINUATION",t[t.SCANNING_ESCAPED=8]="SCANNING_ESCAPED",t[t.SCANNING_ESCAPED_IN_CONTINUATION=9]="SCANNING_ESCAPED_IN_CONTINUATION",t[t.SCANNING_COMMENT=10]="SCANNING_COMMENT",t[t.FAIL=11]="FAIL",t[t.DONE=12]="DONE",t[t.START=13]="START"}(s||(s={}));const n=/^[a-zA-Z0-9_:-]/,i=[];i[s.START]=function(t,e){return"{"===t.subject.charAt(e)?s.SCANNING:s.FAIL},i[s.FAIL]=function(t,e){return s.FAIL},i[s.DONE]=function(t,e){return s.DONE},i[s.SCANNING]=function(t,e){const i=t.subject.charAt(e);return" "===i||"\t"===i||"\n"===i||"\r"===i?s.SCANNING:"}"===i?s.DONE:"#"===i?(t.begin=e,s.SCANNING_ID):"%"===i?(t.begin=e,s.SCANNING_COMMENT):"."===i?(t.begin=e,s.SCANNING_CLASS):function(t){return null!==n.exec(t)}(i)?(t.begin=e,s.SCANNING_KEY):s.FAIL},i[s.SCANNING_COMMENT]=function(t,e){return"%"===t.subject.charAt(e)?s.SCANNING:s.SCANNING_COMMENT},i[s.SCANNING_ID]=function(t,e){const n=t.subject.substr(e,1);return null!==/^\w/.exec(n)||"_"===n||"-"===n||":"===n?s.SCANNING_ID:"}"===n?(t.begin&&t.lastpos&&t.lastpos>t.begin&&t.addEvent(t.begin+1,t.lastpos,"id"),t.begin=null,s.DONE):null!==/^\s/.exec(n)?(t.begin&&t.lastpos&&t.lastpos>t.begin&&t.addEvent(t.begin+1,t.lastpos,"id"),t.begin=null,s.SCANNING):s.FAIL},i[s.SCANNING_CLASS]=function(t,e){const n=t.subject.substr(e,1);return null!==/^\w/.exec(n)||"_"===n||"-"===n||":"===n?s.SCANNING_CLASS:"}"===n?(t.begin&&t.lastpos&&t.lastpos>t.begin&&t.addEvent(t.begin+1,t.lastpos,"class"),t.begin=null,s.DONE):null!==/^\s/.exec(n)?(t.begin&&t.lastpos&&t.lastpos>t.begin&&t.addEvent(t.begin+1,t.lastpos,"class"),t.begin=null,s.SCANNING):s.FAIL},i[s.SCANNING_KEY]=function(t,e){const n=t.subject.substr(e,1);return"="===n&&t.begin&&t.lastpos?(t.addEvent(t.begin,t.lastpos,"key"),t.begin=null,s.SCANNING_VALUE):null!==/^[a-zA-Z0-9_:-]/.exec(n)?s.SCANNING_KEY:s.FAIL},i[s.SCANNING_VALUE]=function(t,e){const n=t.subject.charAt(e);return'"'===n?(t.begin=e,s.SCANNING_QUOTED_VALUE):null!==/^[a-zA-Z0-9_:-]/.exec(n)?(t.begin=e,s.SCANNING_BARE_VALUE):s.FAIL},i[s.SCANNING_BARE_VALUE]=function(t,e){const n=t.subject.charAt(e);return null!==/^[a-zA-Z0-9_:-]/.exec(n)?s.SCANNING_BARE_VALUE:"}"===n&&t.begin&&t.lastpos?(t.addEvent(t.begin,t.lastpos,"value"),t.begin=null,s.DONE):/^\s/.exec(n)&&t.begin&&t.lastpos?(t.addEvent(t.begin,t.lastpos,"value"),t.begin=null,s.SCANNING):s.FAIL},i[s.SCANNING_ESCAPED]=function(t,e){return s.SCANNING_QUOTED_VALUE},i[s.SCANNING_ESCAPED_IN_CONTINUATION]=function(t,e){return s.SCANNING_QUOTED_VALUE_CONTINUATION},i[s.SCANNING_QUOTED_VALUE]=function(t,e){const n=t.subject.charAt(e);return'"'===n&&t.begin&&t.lastpos?(t.addEvent(t.begin+1,t.lastpos,"value"),t.begin=null,s.SCANNING):"\n"===n&&t.begin&&t.lastpos?(t.addEvent(t.begin+1,e,"value"),t.begin=null,s.SCANNING_QUOTED_VALUE_CONTINUATION):"\\"===n?s.SCANNING_ESCAPED:s.SCANNING_QUOTED_VALUE},i[s.SCANNING_QUOTED_VALUE_CONTINUATION]=function(t,e){const n=t.subject.charAt(e);return null===t.begin&&(t.begin=e),'"'===n&&t.begin&&t.lastpos?(t.addEvent(t.begin,t.lastpos,"value"),t.begin=null,s.SCANNING):"\n"===n&&t.begin&&t.lastpos?(t.addEvent(t.begin,e,"value"),t.begin=null,s.SCANNING_QUOTED_VALUE_CONTINUATION):"\\"===n?s.SCANNING_ESCAPED_IN_CONTINUATION:s.SCANNING_QUOTED_VALUE_CONTINUATION},e.AttributeParser=class{constructor(t){this.subject=t,this.state=s.START,this.begin=null,this.lastpos=null,this.matches=[]}addEvent(t,e,s){this.matches.push({startpos:t,endpos:e,annot:s})}feed(t,e){let n=t;for(;n<=e;){if(this.state=i[this.state](this,n),this.state===s.DONE)return{status:"done",position:n};if(this.state===s.FAIL)return this.lastpos=n,{status:"fail",position:n};this.lastpos=n,n+=1}return{status:"continue",position:e}}}},155:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EventParser=void 0;const n=s(722),i=s(481),a=s(418),r=function(t){return"+"===t||"-"===t||"*"===t||":"===t?[t]:/^[+*-] \[[Xx ]\]/.exec(t)?["X"]:/^[(]?[0-9]+[).]/.exec(t)?[t.replace(/[0-9]+/,"1")]:/^[(]?[ivxlcdm][).]/.exec(t)?[t.replace(/[a-z]+/,"a"),t.replace(/[a-z]+/,"i")]:/^[(]?[IVXLCDM][).]/.exec(t)?[t.replace(/[A-Z]+/,"A"),t.replace(/[A-Z]+/,"I")]:/^[(]?[ivxlcdm]+[).]/.exec(t)?[t.replace(/[a-z]+/,"i")]:/^[(]?[IVXLCDM]+[).]/.exec(t)?[t.replace(/[A-Z]+/,"I")]:/^[(]?[a-z][).]/.exec(t)?[t.replace(/[a-z]/,"a")]:/^[(]?[A-Z][).]/.exec(t)?[t.replace(/[A-Z]/,"A")]:[]},o=function(t){return 32===t||9===t},c=(0,i.pattern)("[ \\t]*\\r?\\n"),l=(0,i.pattern)("[^\\n\\r]*"),h=(0,i.pattern)("^\\w+\\s"),d=(0,i.pattern)("[ \\t\\r\\n]"),u=(0,i.pattern)("[^ \\t\\r\\n]+"),p=(0,i.pattern)("[>][ \\t\\r\\n]"),b=(0,i.pattern)("#+"),f=(0,i.pattern)("(~~~~*|````*)([ \\t]*)([^ \\t\\r\\n`]*)[ \\t]*\\r?\\n"),g=(0,i.pattern)("(:?)--*(:?)([ \\t]*\\|[ \\t]*)"),m=(0,i.pattern)("[^`|\\r\\n]*(?:[|]|`+)"),k=(0,i.pattern)("\\^[ \\t]+"),_=(0,i.pattern)("\\[\\^([^\\]]+)\\]:[ \\t\\r\\n]"),N=(0,i.pattern)("[-*][ \t]*[-*][ \\t]*[-*][-* \\t]*\\r?\\n"),A=(0,i.pattern)("(::::*)[ \\t]*\\r?\\n"),P=(0,i.pattern)("(::::*)[ \\t]*"),C=(0,i.pattern)("([\\w_-]*)[ \\t]*\\r?\\n"),I=(0,i.pattern)("\\[([^\\]\\r\\n]*)\\]:[ \\t]*([^ \\t\\r\\n]*)[\\r\\n]"),x=(0,i.pattern)("(\\|[^\\r\\n]*\\|)[ \\t]*\\r?\\n"),M=(0,i.pattern)("(:?[-*+:]|\\([0-9]+\\)|[0-9]+[.)]|[ivxlcdmIVXLCDM]+[.)]|\\([ivxlcdmIVXLCDM]+\\)|[a-zA-Z][.)]|\\([a-zA-Z]\\))[ \\t\\r\\n]"),S=(0,i.pattern)("[*+-] \\[[Xx ]\\][ \\t\\r\\n]");var y;!function(t){t[t.None=0]="None",t[t.Inline=1]="Inline",t[t.Block=2]="Block",t[t.Text=3]="Text",t[t.Cells=4]="Cells",t[t.Attributes=5]="Attributes",t[t.ListItem=6]="ListItem"}(y||(y={}));class v{constructor(t,e){this.name=t.name,this.type=t.type,this.content=t.content,this.continue=t.continue,this.close=t.close,this.indent=null,this.inlineParser=null,this.attributeParser=null,this.extra=e}}class E{constructor(t,e){"\n"!==t.charAt(t.length-1)&&(t+="\n"),this.subject=t,this.maxoffset=t.length-1,this.warn=e,this.indent=0,this.startline=0,this.starteol=0,this.endeol=0,this.matches=[],this.containers=[],this.pos=0,this.lastMatchedContainer=0,this.finishedLine=!1,this.returned=0,this.paraSpec={name:"para",type:y.Block,content:y.Inline,continue:t=>null===this.find(d),open:t=>(this.addContainer(new v(t,{})),this.addMatch(this.pos,this.pos,"+para"),!0),close:t=>{this.getInlineMatches();const e=this.matches[this.matches.length-1],s=e&&e.endpos+1||this.pos;this.addMatch(s,s,"-para"),this.containers.pop()}},this.specs=[{name:"blockquote",type:y.Block,content:y.Block,continue:t=>null!==this.find(p)&&(this.pos=this.pos+1,!0),open:t=>null!==this.find(p)&&(this.addContainer(new v(t,{})),this.addMatch(this.pos,this.pos,"+blockquote"),this.pos=this.pos+1,!0),close:t=>{this.addMatch(this.pos,this.pos,"-blockquote"),this.containers.pop()}},{name:"heading",type:y.Block,content:y.Inline,continue:t=>{const e=this.find(b);return!(!e||t.extra.level!==e.endpos-e.startpos+1||!(0,i.find)(this.subject,d,e.endpos+1)||(this.pos=e.endpos+1,0))},open:t=>{const e=this.find(b);if(e&&(0,i.find)(this.subject,d,e.endpos+1)){const s=e.endpos-e.startpos+1;return this.addContainer(new v(t,{level:s})),this.addMatch(e.startpos,e.endpos,"+heading"),this.pos=e.endpos+1,!0}return!1},close:t=>{this.getInlineMatches();const e=this.matches[this.matches.length-1],s=e&&e.endpos+1||this.pos;this.addMatch(s,s,"-heading"),this.containers.pop()}},{name:"caption",type:y.Block,content:y.Inline,continue:t=>null===(0,i.find)(this.subject,d,this.pos),open:t=>{const e=this.find(k);return!!e&&(this.pos=e.endpos+1,this.addContainer(new v(t,{})),this.addMatch(this.pos,this.pos,"+caption"),!0)},close:t=>{this.getInlineMatches(),this.addMatch(this.pos-1,this.pos-1,"-caption"),this.containers.pop()}},{name:"footnote",type:y.Block,content:y.Block,continue:t=>this.indent>(t.extra.indent||0)||this.pos===this.starteol,open:t=>{const e=this.find(_);if(e){const s=e.startpos,n=e.endpos,i=e.captures[0];return this.addContainer(new v(t,{note_label:i,indent:this.indent})),this.addMatch(s,s,"+footnote"),this.addMatch(s+2,n-3,"note_label"),this.pos=n,!0}return!1},close:t=>{this.addMatch(this.pos,this.pos,"-footnote"),this.containers.pop()}},{name:"reference_definition",type:y.Block,content:y.None,continue:t=>{if(t.extra.indent>=this.indent)return!1;const e=this.find(u);return!!(this.pos<this.starteol&&e&&e.endpos===this.starteol-1)&&(this.addMatch(this.pos,this.starteol-1,"reference_value"),this.pos=this.starteol,!0)},open:t=>{const e=this.find(I);if(e){const s=e.captures[0],n=e.captures[1];return this.addContainer(new v(t,{key:s,indent:this.indent})),this.addMatch(e.startpos,e.startpos,"+reference_definition"),this.addMatch(e.startpos,e.startpos+s.length+1,"reference_key"),n.length>0&&this.addMatch(this.starteol-n.length,this.starteol-1,"reference_value"),this.pos=this.starteol-1,!0}return!1},close:t=>{this.addMatch(this.pos,this.pos,"-reference_definition"),this.containers.pop()}},{name:"thematic_break",type:y.Block,content:y.None,continue:t=>!1,open:t=>{const e=this.find(N);return!!e&&(this.addContainer(new v(t,{})),this.addMatch(e.startpos,e.endpos,"thematic_break"),this.pos=e.endpos,!0)},close:t=>{this.containers.pop()}},{name:"list",type:y.Block,content:y.ListItem,continue:t=>{if(this.indent>t.extra.indent||this.pos===this.starteol)return!0;{const e=this.find(M);if(null===e)return!1;let s=this.subject.substring(e.startpos,e.endpos);const n=this.find(S);null!==n&&(s=this.subject.substring(n.startpos,n.startpos+5));const i=r(s),a=[];if(t.extra.styles.forEach((t=>{i.includes(t)&&a.push(t)})),a.length>0)return t.extra.styles=a,!0}return!1},open:t=>{const e=this.find(M);if(null===e)return!1;const s=e.startpos,n=e.endpos;let i=this.subject.substring(s,n);const a=this.find(S);null!==a&&(i=this.subject.substring(a.startpos,a.startpos+5));const o=r(i);if(0===o.length)return!1;const c={styles:o,indent:this.indent};this.addContainer(new v(t,c));let l="+list";return o.forEach((t=>{l=l+"|"+t})),this.addMatch(s,n-1,l),!0},close:t=>{this.addMatch(this.pos,this.pos,"-list"),this.containers.pop()}},{name:"list_item",type:y.ListItem,content:y.Block,continue:t=>this.indent>t.extra.indent||this.pos===this.starteol,open:t=>{const e=this.find(M);if(null===e)return!1;const s=e.startpos,n=e.endpos;let i=this.subject.substring(s,n),a=null;const o=this.find(S);null!==o&&(i=this.subject.substring(o.startpos,o.startpos+5),a=this.subject.substring(o.startpos+3,o.startpos+4));const c=r(i);if(0===c.length)return!1;const l={styles:c,indent:this.indent};this.addContainer(new v(t,l));let h="+list_item";return c.forEach((t=>{h=h+"|"+t})),this.addMatch(s,n-1,h),this.pos=n,a&&(" "===a?this.addMatch(s+2,s+4,"checkbox_unchecked"):this.addMatch(s+2,s+4,"checkbox_checked"),this.pos=s+5),!0},close:t=>{this.addMatch(this.pos,this.pos,"-list_item"),this.containers.pop()}},{name:"table",type:y.Block,content:y.Cells,continue:t=>{const e=this.find(x);if(e){const t=e.captures[0];return this.parseTableRow(e.startpos,e.startpos+t.length-1)}return!1},open:t=>{const e=this.find(x);if(e){this.addContainer(new v(t,{columns:0}));const s=e.captures[0];return this.addMatch(e.startpos,e.startpos,"+table"),!!this.parseTableRow(e.startpos,e.startpos+s.length-1)||(this.matches.pop(),this.containers.pop(),!1)}return!1},close:t=>{this.addMatch(this.pos,this.pos,"-table"),this.containers.pop()}},{name:"attributes",type:y.Block,content:y.Attributes,open:t=>{if(123===this.subject.codePointAt(this.pos)){const e=new n.AttributeParser(this.subject),s=e.feed(this.pos,this.starteol);if("fail"===s.status)return!1;if("done"===s.status&&null===(0,i.find)(this.subject,c,s.position+1))return!1;{const n=this.addContainer(new v(t,{status:s.status,indent:this.indent,startpos:this.pos,slices:[]}));return n.attributeParser=e,n.extra.slices=[{startpos:this.pos,endpos:this.starteol}],this.pos=this.starteol,!0}}return!1},continue:t=>{if("done"===t.extra.status)return!1;if(t.attributeParser&&this.indent>t.extra.indent){t.extra.slices.push({startpos:this.pos,endpos:this.starteol});const e=t.attributeParser.feed(this.pos,this.endeol);if(t.extra.status=e.status,"fail"!==e.status||!(0,i.find)(this.subject,c,e.position+1))return this.pos=this.starteol,!0}this.addMatch(t.extra.startpos,t.extra.startpos,"+para");const e=this.containers.pop(),s=this.addContainer(new v(this.paraSpec,{}));if(!s.inlineParser||!e)throw new Error("Missing inlineParser or attrContainer");return s.inlineParser.attributeSlices=e.extra.slices,s.inlineParser.reparseAttributes(),this.pos=s.inlineParser.lastpos+1,!0},close:t=>{this.addMatch(t.extra.startpos,t.extra.startpos,"+block_attributes"),t.attributeParser&&t.attributeParser.matches.forEach((t=>{this.matches.push(t)})),this.addMatch(this.pos,this.pos,"-block_attributes"),this.containers.pop()}},{name:"fenced_div",type:y.Block,content:y.Block,continue:t=>{const e=this.tip();if(e&&"code_block"===e.name)return!0;const s=this.find(A);if(s&&t.extra.colons){const e=s.captures[0];if(e.length>=t.extra.colons)return t.extra.endFenceStartpos=s.startpos,t.extra.endFenceEndpos=s.startpos+e.length-1,this.pos=s.endpos,!1}return!0},open:t=>{const e=this.find(P);if(!e)return!1;const s=e.captures[0],n=(0,i.find)(this.subject,C,e.endpos+1);if(!n)return!1;const a=n.startpos,r=n.captures[0];return this.addContainer(new v(t,{colons:s.length})),this.addMatch(e.startpos,e.endpos,"+div"),r.length>0&&this.addMatch(a,a+r.length-1,"class"),this.pos=n.endpos+1,this.finishedLine=!0,!0},close:t=>{const e=t.extra.endFenceStartpos||this.pos,s=t.extra.endFenceEndpos||this.pos;this.addMatch(e,s,"-div"),e===s&&this.warn("Unclosed div",this.pos),this.containers.pop()}},{name:"code_block",type:y.Block,content:y.Text,continue:t=>{const e=this.find(t.extra.closePattern);return!e||(t.extra.endFenceStartpos=e.startpos,t.extra.endFenceEndpos=e.startpos+e.captures[0].length-1,this.pos=e.endpos,this.finishedLine=!0,!1)},open:t=>{const e=this.find(f);if(e){const[s,n,a]=e.captures,r="="===a.charAt(0),o=(0,i.pattern)("("+s+s.substring(0,1)+"*)[ \\t]*[\\r\\n]");if(this.addContainer(new v(t,{closePattern:o})).indent=this.indent,this.addMatch(e.startpos,e.startpos+s.length-1,"+code_block"),a.length>0){const t=e.startpos+s.length+n.length;r?this.addMatch(t,t+a.length-1,"raw_format"):this.addMatch(t,t+a.length-1,"code_language")}return this.pos=e.endpos,this.finishedLine=!0,!0}return!1},close:t=>{const e=t.extra.endFenceStartpos||this.pos,s=t.extra.endFenceEndpos||this.pos;this.addMatch(e,s,"-code_block"),e===s&&this.warn("Unclosed code block",this.pos),this.containers.pop()}}]}find(t){return(0,i.find)(this.subject,t,this.pos)}tip(){return this.containers.length>=1?this.containers[this.containers.length-1]:null}addMatch(t,e,s){this.matches.push({startpos:Math.min(t,this.maxoffset),endpos:Math.min(e,this.maxoffset),annot:s})}getInlineMatches(){const t=this.tip(),e=t&&t.inlineParser;e&&e.getMatches().forEach((t=>this.matches.push(t)))}closeUnmatchedContainers(){const t=this.lastMatchedContainer;let e=this.tip();for(;e&&this.containers.length-1>t;)e.close(e),e=this.tip()}addContainer(t){this.closeUnmatchedContainers();let e=this.tip();for(;e&&e.content!==t.type;)e.close(e),e=this.tip();return t.content===y.Inline&&(t.inlineParser=new a.InlineParser(this.subject,this.warn)),this.containers.push(t),t}skipSpace(){const t=this.subject;let e=this.pos;for(;;){const s=t.codePointAt(e);if(!s||!o(s))break;e++}this.indent=e-this.startline,this.pos=e}getEol(){const t=(0,i.find)(this.subject,l,this.pos);t&&(this.starteol=t.endpos+1,13===this.subject.codePointAt(this.starteol)&&10===this.subject.codePointAt(this.starteol+1)?this.endeol=this.starteol+1:this.endeol=this.starteol)}parseTableCell(){const t=new a.InlineParser(this.subject,this.warn);let e=!1;const s=this.pos-1;let n=s;for(this.skipSpace();!e;){const s=this.find(m);if(null===s){e=!1;break}{const i=s.endpos;"`"===this.subject.charAt(i)||t.inVerbatim()||"\\"===this.subject.charAt(i-1)?t.feed(this.pos,i):(t.feed(this.pos,i-1),n=i,e=!0),this.pos=i+1}}return e?{startpos:s,endpos:n,matches:t.getMatches()}:null}parseTableRow(t,e){const s=this.matches.length,n=this.pos;this.addMatch(t,t,"+row"),this.pos++;const a=[];let r=this.pos,o=!1;for(;!o;){const t=(0,i.find)(this.subject,g,r);if(null===t)break;{const[e,s,n]=t.captures;let i="separator_default";if(e.length>0&&s.length>0?i="separator_center":s.length>0?i="separator_right":e.length>0&&(i="separator_left"),a.push({startpos:t.startpos,endpos:t.endpos-n.length,annot:i}),r=t.endpos+1,r===this.starteol){o=!0;break}}}if(o){for(const t in a){const e=a[t];this.addMatch(e.startpos,e.endpos,e.annot)}return this.addMatch(this.starteol-1,this.starteol-1,"-row"),this.pos=this.starteol,this.finishedLine=!0,!0}for(;this.pos<=e;){const t=this.parseTableCell();if(null===t){for(this.pos=n;this.matches.length>s;)this.matches.pop();return!1}{this.addMatch(t.startpos,t.startpos,"+cell");const e=t.matches;e.forEach(((t,s)=>{const n=t.startpos;let i=t.endpos;if(s===e.length-1&&"str"===t.annot)for(;32===this.subject.codePointAt(i)&&i>=n;)i-=1;this.addMatch(n,i,t.annot)})),this.addMatch(t.endpos,t.endpos,"-cell")}}return this.addMatch(this.pos,this.pos,"-row"),this.pos=this.starteol,this.finishedLine=!0,!0}[Symbol.iterator](){const t=this.specs,e=this.subject.length;this.returned=0;const s=this;return{next(){for(;s.pos<e;){if(s.matches.length>0&&s.returned<s.matches.length)return s.returned=s.returned+1,{value:s.matches[s.returned-1],done:!1};s.indent=0,s.startline=s.pos,s.finishedLine=!1,s.getEol(),s.lastMatchedContainer=-1;let e=0;for(;e<s.containers.length;){const t=s.containers[e];if(s.skipSpace(),!t.continue(t))break;s.lastMatchedContainer=e,e+=1}if(s.finishedLine)for(;s.containers.length>0&&s.lastMatchedContainer<s.containers.length-1;){const t=s.tip();t&&t.close(t)}if(!s.finishedLine){s.skipSpace();let e=s.pos===s.starteol,n=!1,i=s.containers[s.lastMatchedContainer],r=!(e||i&&i.content!==y.Block&&i.content!==y.ListItem||s.find(h));for(;r;){r=!1;for(const e of t)if((!i&&e.type===y.Block||i&&i.content===e.type)&&e.open(e)){if(!s.tip())throw new Error("No tip after opening container");s.lastMatchedContainer=s.containers.length-1,i=s.containers[s.lastMatchedContainer],s.finishedLine?r=!1:(s.skipSpace(),n=!0,r=e.content===y.Block||e.content===y.ListItem);break}}if(!s.finishedLine){s.skipSpace(),e=s.pos===s.starteol;let t=s.tip();if(!e&&!n&&s.lastMatchedContainer<s.containers.length-1&&t&&t.content===y.Inline||s.closeUnmatchedContainers(),t=s.tip(),t&&t.content!==y.Block||(e?n||s.addMatch(s.pos,s.endeol,"blankline"):(s.paraSpec.open(s.paraSpec),t=s.tip(),t&&(t.inlineParser=new a.InlineParser(s.subject,s.warn)))),t&&t.content===y.Text){let e=s.pos;null!==t.indent&&s.indent>t.indent&&(e-=s.indent-t.indent),s.addMatch(e,s.endeol,"str")}else t&&t.content===y.Inline&&!e&&t.inlineParser&&t.inlineParser.feed(s.pos,s.endeol)}}s.pos=(s.endeol||s.pos)+1}return s.lastMatchedContainer=-1,s.closeUnmatchedContainers(),s.matches.length>0&&s.returned<s.matches.length?(s.returned=s.returned+1,{value:s.matches[s.returned-1],done:!1}):{value:{startpos:s.pos,endpos:s.pos,annot:""},done:!0}}}}}e.EventParser=E},322:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyFilter=void 0;const s=function(t,e){if(!t||!t.tag)throw new Error("Filter caled on a non-node.");let n,i;const a=e[t.tag];if(a){if("exit"in a&&a.exit)i=a.exit,n=a.enter;else{if("function"!=typeof a)throw new Error("Transform has wrong type.");i=a}if(n&&n(t))return}if("children"in t&&t.children&&t.children.forEach((t=>{s(t,e)})),"footnotes"in t&&t.footnotes)for(const n in t.footnotes){const i=t.footnotes[n];s(i,e)}i&&i(t)},n=function(t,e){return s(t,e),t};e.applyFilter=function(t,e){const s=e();if(Array.isArray(s))for(let e=0;e<s.length;e++)n(t,s[e]);else{if("object"!=typeof s)throw new Error("Filter returned wrong type: "+typeof s);n(t,s)}}},481:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.boundedFind=e.find=e.pattern=void 0,e.pattern=function(t){return new RegExp(t,"yd")};const s=function(t,e,s){e.lastIndex=s;const n=e.exec(t);if(null!==n){let e=1;const s=[];for(;n.indices[e];)s.push(t.substring(n.indices[e][0],n.indices[e][1])),e++;return{startpos:n.indices[0][0],endpos:n.indices[0][1]-1,captures:s}}return null};e.find=s,e.boundedFind=function(t,e,n,i){const a=s(t,e,n);return null!==a&&a.endpos<=i?a:null}},240:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.renderHTML=void 0;const n=s(306),i=function(t,e){console.log(t+(e?" at "+e:"")+"\n")};class a{constructor(t){this.warn=t.warn||i,this.options=t||{},this.buffer=[],this.tight=!1,this.footnoteIndex={},this.nextFootnoteIndex=1,this.references={},this.footnotes={}}escape(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}escapeAttribute(t){return this.escape(t).replace(/"/g,"&quot;")}out(t){this.buffer.push(this.escape(t))}literal(t){this.buffer.push(t)}renderAttributes(t,e){if(e)for(const s in e)if("class"===s){let n=e[s];t.attributes&&t.attributes.class&&(n=n+" "+t.attributes.class),this.literal(` ${s}="${this.escapeAttribute(n)}"`)}else this.literal(` ${s}="${this.escapeAttribute(e[s])}"`);if(t.attributes)for(const s in t.attributes){const n=t.attributes[s];"class"===s&&e&&e.class||this.literal(` ${s}="${this.escapeAttribute(n)}"`)}if(this.options.sourcePositions&&t.pos){const e=t.pos.start,s=t.pos.end;this.literal(` data-startpos="${e.line}:${e.col}:${e.offset}" data-endpos="${s.line}:${s.col}:${s.offset}"`)}}renderTag(t,e,s){this.literal("<"),this.literal(t),("attributes"in e||s||e.pos)&&this.renderAttributes(e,s),this.literal(">")}renderCloseTag(t){this.literal("</"),this.literal(t),this.literal(">")}inTags(t,e,s,n){this.renderTag(t,e,n),s>=2&&this.literal("\n"),"children"in e&&this.renderChildren(e),this.renderCloseTag(t),s>=1&&this.literal("\n")}addBacklink(t,e){const s=structuredClone(t),n={tag:"link",destination:`#fnref${e}`,attributes:{role:"doc-backlink"},children:[{tag:"str",text:"↩︎︎"}]};if(s.children.length>=1){const t=s.children[s.children.length-1];"para"===t.tag?t.children.push(n):s.children.push({tag:"para",children:[n]})}else s.children.push({tag:"para",children:[n]});return s}renderChildren(t){const e=this.tight;"tight"in t&&(this.tight=!!t.tight),t.children.forEach((t=>{this.renderAstNode(t)})),"tight"in t&&(this.tight=e)}renderAstNode(t){let e={};switch(t.tag){case"para":this.tight?(this.renderChildren(t),this.literal("\n")):this.inTags("p",t,1);break;case"blockquote":this.inTags("blockquote",t,2);break;case"div":this.inTags("div",t,2);break;case"section":this.inTags("section",t,2);break;case"list_item":e={},t.checkbox&&(e.class="checked"===t.checkbox?"checked":"unchecked"),this.inTags("li",t,2,e);break;case"definition_list_item":this.renderChildren(t);break;case"definition":this.inTags("dd",t,2);break;case"term":this.inTags("dt",t,1);break;case"list":"-"===t.style||"*"===t.style||"+"===t.style?this.inTags("ul",t,2):":"===t.style?this.inTags("dl",t,2):"X"===t.style?this.inTags("ul",t,2,{class:"task-list"}):(e={},t.start&&1!==t.start&&(e.start=t.start.toString()),t.style&&!/1/.test(t.style)&&(e.type=t.style.replace(/[().]/g,"")),this.inTags("ol",t,2,e));break;case"heading":this.inTags(`h${t.level}`,t,1);break;case"footnote_reference":{const e=t.text;let s=this.footnoteIndex[e];s||(s=this.nextFootnoteIndex,this.footnoteIndex[e]=s,this.nextFootnoteIndex++),this.renderTag("a",t,{id:"fnref"+s,href:"#fn"+s,role:"doc-noteref"}),this.literal("<sup>"),this.out(s.toString()),this.literal("</sup></a>");break}case"table":this.inTags("table",t,2);break;case"caption":this.inTags("caption",t,1);break;case"row":this.inTags("tr",t,2);break;case"cell":{const e={};"default"!==t.align&&(e.style=`text-align: ${t.align};`),this.inTags(t.head?"th":"td",t,1,e);break}case"thematic_break":this.renderTag("hr",t),this.literal("\n");break;case"code_block":this.renderTag("pre",t),this.literal("<code"),t.lang&&this.literal(` class="language-${this.escapeAttribute(t.lang)}"`),this.literal(">"),this.out(t.text),this.renderCloseTag("code"),this.renderCloseTag("pre"),this.literal("\n");break;case"raw_block":case"raw_inline":"html"===t.format&&this.literal(t.text);break;case"str":t.attributes?(this.renderTag("span",t),this.out(t.text),this.renderCloseTag("span")):this.out(t.text);break;case"left_double_quote":this.literal("&ldquo;");break;case"right_double_quote":this.literal("&rdquo;");break;case"left_single_quote":this.literal("&lsquo;");break;case"right_single_quote":this.literal("&rsquo;");break;case"double_quoted":this.literal("&ldquo;"),this.renderChildren(t),this.literal("&rdquo;");break;case"single_quoted":this.literal("&lsquo;"),this.renderChildren(t),this.literal("&rsquo;");break;case"ellipses":this.literal("&hellip;");break;case"em_dash":this.literal("&mdash;");break;case"en_dash":this.literal("&ndash;");break;case"symbol":this.out(`:${t.alias}:`);break;case"math":this.renderTag("span",t,{class:"math "+(t.display?"display":"inline")}),t.display?this.out("\\["):this.out("\\("),this.out(t.text),t.display?this.out("\\]"):this.out("\\)"),this.renderCloseTag("span");break;case"verbatim":this.renderTag("code",t),this.out(t.text),this.renderCloseTag("code");break;case"softbreak":this.literal("\n");break;case"hardbreak":this.literal("<br>\n");break;case"nbsp":this.literal("&nbsp;");break;case"link":case"image":{e={};let s=t.destination;if(t.reference){const i=this.references[t.reference];if(i){if(s=i.destination,"image"===t.tag?(e.alt=(0,n.getStringContent)(t),e.src=s):e.href=s,i.attributes)for(const s in i.attributes)t.attributes&&t.attributes[s]||(e[s]=i.attributes[s])}else this.warn(`Reference ${JSON.stringify(t.reference)} not found`,t.pos&&t.pos.end.offset||0)}else"image"===t.tag?(e.alt=(0,n.getStringContent)(t),void 0!==s&&(e.src=s)):void 0!==s&&(e.href=s);"image"===t.tag?this.renderTag("img",t,e):this.inTags("a",t,0,e);break}case"url":case"email":e={},"email"===t.tag?e.href="mailto:"+t.text:e.href=t.text,this.renderTag("a",t,e),this.out(t.text),this.renderCloseTag("a");break;case"strong":this.inTags("strong",t,0);break;case"emph":this.inTags("em",t,0);break;case"span":this.inTags("span",t,0);break;case"mark":this.inTags("mark",t,0);break;case"insert":this.inTags("ins",t,0);break;case"delete":this.inTags("del",t,0);break;case"superscript":this.inTags("sup",t,0);break;case"subscript":this.inTags("sub",t,0)}}render(t){if(this.references=t.references,this.footnotes=t.footnotes,this.renderChildren(t),this.nextFootnoteIndex>1){const t=[];for(const e in this.footnotes)t[this.footnoteIndex[e]]=this.footnotes[e];this.literal('<section role="doc-endnotes">\n<hr>\n<ol>\n');for(let e=1;e<t.length;e++){this.literal(`<li id="fn${e}">\n`);const s=this.addBacklink(t[e],e);this.renderChildren(s),this.literal("</li>\n")}this.literal("</ol>\n</section>\n")}return this.buffer.join("")}}e.renderHTML=function(t,e={}){return new a(e).render(t)}},418:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InlineParser=void 0;const n=s(722),i=s(481),a=123,r=125,o=function(t){return 10===t||13===t||34===t||39===t||40===t||41===t||42===t||43===t||45===t||46===t||58===t||60===t||61===t||91===t||92===t||93===t||94===t||95===t||96===t||36===t||t===a||t===r||126===t},c=function(t,e,s){let n=e;for(;n<=s;){let e=t.codePointAt(n);if(!e)return null;if(o(e))return n;n++,e=t.codePointAt(n)}return null},l=(0,i.pattern)("[^ \t\r\n]"),h=(0,i.pattern)("[ \\t]*\\r?\\n"),d=(0,i.pattern)("['!\"#$%&\\\\'()\\*+,\\-\\.\\/:;<=>?@\\[\\]\\^_`{|}~']"),u=(0,i.pattern)("\\<([^<>\\s]+)\\>"),p=(0,i.pattern)("[_*~^+='\"-]"),b=(0,i.pattern)(":[\\w_+-]+:"),f=(0,i.pattern)("\\.\\."),g=(0,i.pattern)("`*"),m=(0,i.pattern)("`+"),k=(0,i.pattern)("\\$\\$"),_=(0,i.pattern)("\\$"),N=(0,i.pattern)("\\\\"),A=(0,i.pattern)("\\{=[^\\s{}`]+\\}"),P=(0,i.pattern)("\\^([^\\]]+)\\]"),C=function(t,e){return e>0&&t.subject.codePointAt(e-1)===a||t.subject.codePointAt(e+1)===r},I=function(){return!0},x=function(t,e,s,n){return function(a,o,c){const h=a.subject;let d=null!==(0,i.find)(h,l,o+1)&&n(a,o),u=null!==(0,i.find)(h,l,o-1);const p=(b=a.matches[o-1],f=(0,i.pattern)("open_marker"),b&&null!==f.exec(b.annot));var b,f;const g=o+1<=c&&h.codePointAt(o+1)===r;let m=o,k=o;p&&(d=!0,u=!1,k=o-1),!p&&g&&(u=!0,d=!1,m=o+1),p&&s.match(/^right/)?s=s.replace(/^right/,"left"):g&&s.match(/^left/)&&(s=s.replace(/^left/,"right"));let _=t;g&&(_="{"+_);const N=a.openers[_];if(u&&N&&N.length>0){const t=N[N.length-1];if(t.endpos!==o-1)return a.clearOpeners(t.startpos,o),a.addMatch(t.startpos,t.endpos,"+"+e),a.addMatch(o,m,"-"+e),m+1}if(d){let e=t;return p&&(e="{"+e),a.addOpener(e,{startpos:k,endpos:o,annot:null,substartpos:null,subendpos:null}),a.addMatch(k,o,s),o+1}return a.addMatch(o,m,s),m+1}},M={96:function(t,e,s){const n=t.subject,a=(0,i.boundedFind)(n,g,e,s);if(null===a)return null;const r=a.endpos;return(0,i.find)(n,k,e-2)&&!(0,i.find)(n,N,e-3)?(delete t.matches[e-2],delete t.matches[e-1],t.addMatch(e-2,r,"+display_math"),t.verbatimType="display_math"):(0,i.find)(n,_,e-1)?(delete t.matches[e-1],t.addMatch(e-1,r,"+inline_math"),t.verbatimType="inline_math"):(t.addMatch(e,r,"+verbatim"),t.verbatimType="verbatim"),t.verbatim=r-e+1,r+1},92:function(t,e,s){const n=t.subject,a=(0,i.boundedFind)(n,h,e+1,s);if(null!==a){if(t.matches.length>0){const e=t.matches[t.matches.length-1];if("str"===e.annot){let s=e.endpos;const i=e.startpos;for(;s>=i&&(32===n.codePointAt(s)||9===n.codePointAt(s));)s-=1;s<i?delete t.matches[t.matches.length-1]:t.addMatch(i,s,"str")}}return t.addMatch(e,e,"escape"),t.addMatch(e+1,a.endpos,"hardbreak"),a.endpos+1}{const a=(0,i.boundedFind)(n,d,e+1,s);return null!==a?(t.addMatch(e,e,"escape"),t.addMatch(a.startpos,a.endpos,"str"),a.endpos+1):e+1<=s&&32===n.codePointAt(e+1)?(t.addMatch(e,e,"escape"),t.addMatch(e+1,e+1,"nbsp"),e+2):(t.addMatch(e,e,"str"),e+1)}},60:function(t,e,s){const n=t.subject,a=(0,i.boundedFind)(n,u,e,s);if(null===a)return null;const r=a.endpos,o=a.startpos,c=a.captures[0];return c.match(/[^:]@/)?(t.addMatch(o,o,"+email"),t.addMatch(o+1,r-1,"str"),t.addMatch(r,r,"-email"),r+1):c.match(/[a-zA-Z]:/)?(t.addMatch(o,o,"+url"),t.addMatch(o+1,r-1,"str"),t.addMatch(r,r,"-url"),r+1):null},126:x("~","subscript","str",I),94:x("^","superscript","str",I),95:x("_","emph","str",I),42:x("*","strong","str",I),43:x("+","insert","str",C),61:x("=","mark","str",C),39:x("'","single_quoted","right_single_quote",(function(t,e){if(0===e)return!0;{const s=t.subject.codePointAt(e-1);return 32===s||9===s||13===s||10===s||34===s||39===s||45===s||40===s||91===s}})),34:x('"',"double_quoted","left_double_quote",I),[a]:function(t,e,s){return(0,i.boundedFind)(t.subject,p,e+1,s)?(t.addMatch(e,e,"open_marker"),e+1):t.allowAttributes?(t.attributeParser=new n.AttributeParser(t.subject),t.attributeStart=e,t.attributeSlices=[],e):(t.addMatch(e,e,"str"),e+1)},58:function(t,e,s){const n=(0,i.boundedFind)(t.subject,b,e,s);return n?(t.addMatch(n.startpos,n.endpos,"symbol"),n.endpos+1):(t.addMatch(e,e,"str"),e+1)},46:function(t,e,s){return(0,i.boundedFind)(t.subject,f,e+1,s)?(t.addMatch(e,e+2,"ellipses"),e+3):null},91:function(t,e,s){const n=(0,i.boundedFind)(t.subject,P,e+1,s);return n?(t.addMatch(e,n.endpos,"footnote_reference"),n.endpos+1):(t.addOpener("[",{startpos:e,endpos:e,annot:null,substartpos:null,subendpos:null}),t.addMatch(e,e,"str"),e+1)},93:function(t,e,s){const n=t.openers["["],i=t.subject;if(n&&n.length>0){const r=n[n.length-1];if("reference_link"===r.annot)return 33===i.codePointAt(r.startpos-1)&&92!==i.codePointAt(r.startpos-2)?(t.addMatch(r.startpos-1,r.startpos-1,"image_marker"),t.addMatch(r.startpos,r.endpos,"+imagetext"),t.addMatch(r.substartpos||r.startpos,r.substartpos||r.startpos,"-imagetext")):(t.addMatch(r.startpos,r.endpos,"+linktext"),t.addMatch(r.substartpos||r.startpos,r.substartpos||r.startpos,"-linktext")),t.addMatch(r.subendpos||r.endpos,r.subendpos||r.endpos,"+reference"),t.addMatch(e,e,"-reference"),t.strMatches((r.subendpos||r.endpos)+1,e-1),t.clearOpeners(r.startpos,e),e+1;if(e+1<=s&&91===i.codePointAt(e+1))return r.annot="reference_link",r.substartpos=e,r.subendpos=e+1,t.addMatch(e,e+1,"str"),t.clearOpeners(r.startpos+1,e-1),e+2;if(e+1<=s&&40===i.codePointAt(e+1))return t.openers["("]=[],r.annot="explicit_link",r.substartpos=e,r.subendpos=e+1,t.destination=!0,t.addMatch(e,e+1,"str"),t.clearOpeners(r.startpos+1,e-1),e+2;if(e+1<=s&&i.codePointAt(e+1)===a)return t.addMatch(r.startpos,r.endpos,"+span"),t.addMatch(e,e,"-span"),t.clearOpeners(r.startpos,e),e+1}return null},40:function(t,e,s){return t.destination?(t.addOpener("(",{startpos:e,endpos:e,annot:null,substartpos:null,subendpos:null}),t.addMatch(e,e,"str"),e+1):null},41:function(t,e,s){if(!t.destination)return null;const n=t.openers["("];if(n&&n.length>0)return n.pop(),t.addMatch(e,e,"str"),e+1;{const s=t.subject,n=t.openers["["],i=n[n.length-1];if(n&&n.length>0&&"explicit_link"===i.annot)return 33===s.codePointAt(i.startpos-1)&&92!==s.codePointAt(i.startpos-2)?(t.addMatch(i.startpos-1,i.startpos-1,"image_marker"),t.addMatch(i.startpos,i.endpos,"+imagetext"),t.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,"-imagetext")):(t.addMatch(i.startpos,i.endpos,"+linktext"),t.addMatch(i.substartpos||i.startpos,i.substartpos||i.startpos,"-linktext")),t.addMatch(i.subendpos||i.endpos,i.subendpos||i.endpos,"+destination"),t.addMatch(e,e,"-destination"),t.destination=!1,t.strMatches((i.subendpos||i.endpos)+1,e-1),t.clearOpeners(i.startpos,e),e+1}return null},45:function(t,e,s){const n=t.subject;if(n.codePointAt(e-1)===a||n.codePointAt(e+1)===r){const n=x("-","delete","str",C)(t,e,s);if(n)return n}let i=e,o=0;for(;i<=s&&45===n.codePointAt(i);)i++,o++;if(n.codePointAt(i)===r&&o--,0===o)return t.addMatch(e,e+1,"str"),e+2;const c=o%3==0,l=o%2==0;for(;o>0;)c?(t.addMatch(e,e+2,"em_dash"),e+=3,o-=3):l?(t.addMatch(e,e+1,"en_dash"),e+=2,o-=2):o>=3&&(o%2!=0||o>4)?(t.addMatch(e,e+2,"em_dash"),e+=3,o-=3):o>=2?(t.addMatch(e,e+1,"en_dash"),e+=2,o-=2):(t.addMatch(e,e,"str"),e+=1,o-=1);return e}};e.InlineParser=class{constructor(t,e){this.warn=e,this.subject=t,this.matches=[],this.openers={},this.verbatim=0,this.verbatimType="",this.destination=!1,this.firstpos=-1,this.lastpos=0,this.allowAttributes=!0,this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,this.matchers=M}addMatch(t,e,s){this.matches[t]={startpos:t,endpos:e,annot:s}}inVerbatim(){return this.verbatim>0}singleChar(t){return this.addMatch(t,t,"str"),t+1}reparseAttributes(){const t=this.attributeSlices;null!==t&&(this.allowAttributes=!1,this.attributeParser=null,this.attributeStart=null,null!==t&&t.forEach((t=>{this.feed(t.startpos,t.endpos)})),this.allowAttributes=!0,this.attributeSlices=null)}getMatches(){const t=[],e=this.subject;this.attributeParser&&this.reparseAttributes();for(let e=this.firstpos;e<=this.lastpos;e++)if(this.matches[e]){const{startpos:s,endpos:n,annot:i}=this.matches[e],a=t[t.length-1];a&&"str"===i&&"str"===a.annot&&a.endpos===s-1?a.endpos=n:t.push(this.matches[e])}if(t.length>0){let s=t[t.length-1],{startpos:n,endpos:i,annot:a}=s;if("softbreak"===a&&(t.pop(),s=t[t.length-1],n=s.startpos,i=s.endpos,a=s.annot),"str"===a&&32===e.codePointAt(i)){for(;i>n&&32===e.codePointAt(i);)i-=1;t[t.length-1].endpos=i}this.verbatim>0&&(this.warn("Unclosed verbatim",i),t.push({startpos:i,endpos:i,annot:"-"+this.verbatimType}))}return t}addOpener(t,e){this.openers[t]||(this.openers[t]=[]),this.openers[t].push(e)}clearOpeners(t,e){for(const s in this.openers){const n=this.openers[s];let i=n.length-1;for(;n[i];){const s=n[i];if(s.startpos>=t&&s.endpos<=e)n.splice(i,1);else{if(!(s.substartpos&&s.substartpos>=t&&s.subendpos&&s.subendpos<=e))break;n[i].substartpos=null,n[i].subendpos=null,n[i].annot=null}i--}}}strMatches(t,e){for(let s=t;s<=e;s++){const t=this.matches[s];t&&"escape"!==t.annot&&"str"!==t.annot&&(t.annot="str")}}feed(t,e){const s=this.subject;(-1===this.firstpos||t<this.firstpos)&&(this.firstpos=t),(0===this.lastpos||e>this.lastpos)&&(this.lastpos=e);let n=t;for(;n<=e;)if(null!==this.attributeParser){const t=n,i=c(s,n,e);let a;a=null===i?e:i;const r=this.attributeParser.feed(t,a),o=r.position;if("done"===r.status){const t=this.attributeStart;null!==t&&(this.addMatch(t,t,"+attributes"),this.addMatch(o,o,"-attributes")),this.attributeParser.matches.forEach((t=>{this.addMatch(t.startpos,t.endpos,t.annot)})),this.attributeParser=null,this.attributeStart=null,this.attributeSlices=null,n=o+1}else"fail"===r.status?(this.reparseAttributes(),n=t):"continue"===r.status&&(null===this.attributeSlices&&(this.attributeSlices=[]),this.attributeSlices.push({startpos:t,endpos:o}),n=o+1)}else{const t=c(s,n,e);let a;if(a=null===t?e+1:t,a>n&&(this.addMatch(n,a-1,"str"),n=a,n>e))break;const r=s.codePointAt(n);if(void 0===r)throw new Error("Code point at "+n+" is undefined.");if(13===r||10===r)13===r&&10===s.codePointAt(n+1)&&n+1<=e?(this.addMatch(n,n+1,"softbreak"),n+=2):(this.addMatch(n,n,"softbreak"),n+=1);else if(this.verbatim>0)if(96===r){const t=(0,i.boundedFind)(s,m,n,e);if(t){const a=t.endpos;if(t.endpos-n+1===this.verbatim){const t=(0,i.boundedFind)(s,A,a+1,e);t&&"verbatim"===this.verbatimType?(this.addMatch(n,a,"-"+this.verbatimType),this.addMatch(t.startpos,t.endpos,"raw_format"),n=t.endpos+1):(this.addMatch(n,a,"-"+this.verbatimType),n=a+1),this.verbatim=0,this.verbatimType="verbatim"}else this.addMatch(n,a,"str"),n=a+1}else this.addMatch(n,e,"str"),n=e+1}else this.addMatch(n,n,"str"),n+=1;else{const t=this.matchers[r];if(t){const s=t(this,n,e);n=null===s?this.singleChar(n):s}else n=this.singleChar(n)}}}}},56:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PandocParser=e.PandocRenderer=void 0;const s=function(t){return"Para"===t.t&&(t.t="Plain"),t},n=function(t){if("attributes"in t&&t.attributes){const e=t.attributes.id||"",s=t.attributes.class&&t.attributes.class.split(" ")||[],n=[];for(const s in t.attributes)s!==e&&"class"!==s&&n.push([s,t.attributes[s]]);return[e,s,n]}return["",[],[]]};e.PandocRenderer=class{constructor(t,e){this.symbols={nbsp:" ",ellipses:"⋯",em_dash:"-",en_dash:"-",left_single_quote:"‘",right_single_quote:"’",left_double_quote:"“",right_double_quote:"”"},this.doc=t,this.warn=e||(()=>{})}toPandocChildren(t){if("children"in t){const e=[];return t.children.forEach((t=>{this.addToPandocElts(e,t)})),e}return[]}toPandocDefinitionListItem(t){const e=this;return function(t){if(!("children"in t))return[];const[s,n]=t.children;let i={tag:"term",children:[]},a={tag:"definition",children:[]};"term"===s.tag?(i=s,"definition"===n.tag&&(a=n)):"definition"===s.tag&&(a=s);const r=[];return i&&r.push(e.toPandocChildren(i)),a&&r.push([e.toPandocChildren(a)]),r}}toPandocListItem(t){const e=this;return function(n){let i=e.toPandocChildren(n);return"checkbox"in n&&n.checkbox&&"Para"===i[0].t&&("checked"===n.checkbox?i[0].c.unshift({t:"Str",c:"☒"},{t:"Space"}):i[0].c.unshift({t:"Str",c:"☐"},{t:"Space"})),"tight"in t&&t.tight&&(i=i.map(s)),i}}addToPandocElts(t,e){switch(e.tag){case"section":case"div":{const s=n(e);"section"===e.tag&&s[1].unshift("section"),t.push({t:"Div",c:[s,this.toPandocChildren(e)]});break}case"blockquote":t.push({t:"BlockQuote",c:this.toPandocChildren(e)});break;case"list":{let s;if(e.style&&"-"===e.style||"+"===e.style||"*"===e.style||"X"===e.style)s=e.children.map(this.toPandocListItem(e)),t.push({t:"BulletList",c:s});else if(":"===e.style)s=e.children.map(this.toPandocDefinitionListItem(e)),t.push({t:"DefinitionList",c:s});else{s=e.children.map(this.toPandocListItem(e));const n=e.style.replace(/[().]/g,"");let i,a;i="1"===n?"Decimal":"a"===n?"LowerAlpha":"A"===n?"UpperAlpha":"i"===n?"LowerRoman":"I"===n?"UpperRoman":"DefaultStyle";const r=/^[(]/.test(e.style);a=/[)]$/.test(e.style)?r?"TwoParens":"OneParen":"Period";const o=e.start||1;t.push({t:"OrderedList",c:[[o,{t:i},{t:a}],s]})}break}case"list_item":break;case"para":t.push({t:"Para",c:this.toPandocChildren(e)});break;case"heading":t.push({t:"Header",c:[e.level,n(e),this.toPandocChildren(e)]});break;case"code_block":{const s=n(e);e.lang&&s[1].unshift(e.lang),t.push({t:"CodeBlock",c:[s,e.text]});break}case"raw_block":t.push({t:"RawBlock",c:[e.format,e.text]});break;case"thematic_break":t.push({t:"HorizontalRule"});break;case"table":{const s=n(e),i=["",[],[]];let a=[],r=[],o=[];const c=[],l=[i,[]];let h=[],d=[];const u={left:"AlignLeft",right:"AlignRight",center:"AlignCenter",default:"AlignDefault"},p=function(t){return[{t:u[t.align]||"AlignDefault"},{t:"ColWidthDefault"}]},b=this,f=function(t){if("children"in t)return[n(t),{t:"align"in t&&u[t.align]||"AlignDefault"},1,1,[{t:"Plain",c:b.toPandocChildren(t)}]]},g=function(t){if("children"in t)return[n(t),t.children.map(f)]};for(let t=0;t<e.children.length;t++){const s=e.children[t];if(!("children"in s))break;0===r.length&&(r=s.children.map(p)),"caption"===s.tag?a=this.toPandocChildren(s):s.head?0===d.length?h.push(g(s)):(c.push([i,0,h,d]),d=[],h=[g(s)]):(0===c.length&&0===d.length&&(o=h,h=[]),d.push(g(s)))}(h.length>0||d.length>0)&&c.push([i,0,h,d]),t.push({t:"Table",c:[s,[null,[{t:"Plain",c:a}]],r,[i,o],c,l]});break}case"raw_inline":t.push({t:"RawInline",c:[e.format,e.text]});break;case"softbreak":t.push({t:"SoftBreak"});break;case"hardbreak":t.push({t:"LineBreak"});break;case"str":e.text.split(/ +/).forEach(((e,s)=>{s>0&&t.push({t:"Space"}),e.length>0&&t.push({t:"Str",c:e})}));break;case"verbatim":t.push({t:"Code",c:[n(e),e.text]});break;case"math":t.push({t:"Math",c:[{t:e.display?"DisplayMath":"InlineMath"},e.text]});break;case"nbsp":case"ellipses":case"em_dash":case"en_dash":case"left_single_quote":case"right_single_quote":case"left_double_quote":case"right_double_quote":t.push({t:"Str",c:this.symbols[e.tag]||""});break;case"symbol":t.push({t:"Span",c:[["",["symbol"],[["alias",e.alias]]],[{t:"Str",c:":"+e.alias+":"}]]});break;case"single_quoted":case"double_quoted":{const s={t:"single_quoted"===e.tag?"SingleQuote":"DoubleQuote"};t.push({t:"Quoted",c:[s,this.toPandocChildren(e)]});break}case"email":case"url":{let s=e.text;"email"===e.tag&&(s="mailto:"+s);const i=n(e);i[1].unshift("email"===e.tag?"email":"uri"),t.push({t:"Link",c:[i,[{t:"Str",c:e.text}],[s,""]]});break}case"image":case"link":{let s=e.destination||"";const i={};if(e.reference){const t=this.doc.references[e.reference];if(t){if(s=t.destination||"",t.attributes)for(const e in t.attributes)i[e]=t.attributes[e]}else this.warn("Reference "+e.reference+" not found.")}if(e.attributes)for(const t in e.attributes)i[t]&&"class"===t?i[t]+=" "+e.attributes[t]:i[t]||(i[t]=e.attributes[t]);const a=n({tag:"link",attributes:i,children:[]}),r=s||"",o=e.attributes&&e.attributes.title||"";o&&(a[2]=a[2].filter((([t,e])=>"title"!==t))),t.push({t:"link"===e.tag?"Link":"Image",c:[a,this.toPandocChildren(e),[r,o]]});break}case"emph":t.push({t:"Emph",c:this.toPandocChildren(e)});break;case"strong":t.push({t:"Strong",c:this.toPandocChildren(e)});break;case"superscript":t.push({t:"Superscript",c:this.toPandocChildren(e)});break;case"subscript":t.push({t:"Subscript",c:this.toPandocChildren(e)});break;case"span":t.push({t:"Span",c:[n(e),this.toPandocChildren(e)]});break;case"mark":t.push({t:"Span",c:[["",["mark"],[]],this.toPandocChildren(e)]});break;case"insert":t.push({t:"Underline",c:this.toPandocChildren(e)});break;case"delete":t.push({t:"Strikeout",c:this.toPandocChildren(e)});break;case"footnote_reference":{const s=this.doc.footnotes[e.text];s?t.push({t:"Note",c:this.toPandocChildren(s)}):t.push({t:"Superscript",c:[{t:"Str",c:e.text}]});break}default:this.warn("Skipping unhandled node "+e.tag)}}toPandoc(){return{"pandoc-api-version":[1,22,2,1],meta:{},blocks:this.toPandocChildren(this.doc)}}};const i=function(t){const e={};t[0]&&(e.id=t[0]),t[1].length>0&&(e.class=t[1].join(" "));for(let s=0;s<t[2].length;s++)e[t[2][s][0].toString()]=t[2][s][1];return 0===Object.keys(e).length?null:e},a=function(t){return"Plain"===t.t||"Para"===t.t},r=function(t){if(!t[0])return null;const e=t[0];return a(e)&&e.c.length>=2&&"Str"===e.c[0].t&&"Space"===e.c[1].t?"☒"===e.c[0].c?(e.c.shift(),e.c.shift(),"checked"):"☐"===e.c[0].c?(e.c.shift(),e.c.shift(),"unchecked"):null:null};e.PandocParser=class{constructor(t){this.footnotes={},this.footnoteIndex=0,this.warn=t||(()=>{})}fromPandocInlines(t){let e=[];const s=[];for(let n=0;n<t.length;n++){const a=t[n];if("Str"===a.t)e.push(a.c);else if("Space"===a.t)e.push(" ");else switch(e.length>0&&(s.push({tag:"str",text:e.join("")}),e=[]),a.t){case"SoftBreak":s.push({tag:"softbreak"});break;case"LineBreak":s.push({tag:"hardbreak"});break;case"Emph":s.push({tag:"emph",children:this.fromPandocInlines(a.c)});break;case"Strong":s.push({tag:"strong",children:this.fromPandocInlines(a.c)});break;case"Superscript":s.push({tag:"superscript",children:this.fromPandocInlines(a.c)});break;case"Subscript":s.push({tag:"subscript",children:this.fromPandocInlines(a.c)});break;case"Strikeout":s.push({tag:"delete",children:this.fromPandocInlines(a.c)});break;case"Span":{const t={tag:"span",children:this.fromPandocInlines(a.c[1])},e=i(a.c[0]);e&&(t.attributes=e),s.push(t);break}case"Underline":s.push({tag:"span",attributes:{class:"underline"},children:this.fromPandocInlines(a.c)});break;case"SmallCaps":s.push({tag:"span",attributes:{class:"smallcaps"},children:this.fromPandocInlines(a.c)});break;case"Math":s.push({tag:"math",display:"DisplayMath"===a.c[0].t,text:a.c[1]});break;case"Quoted":"SingleQuote"===a.c[0].t?s.push({tag:"single_quoted",children:this.fromPandocInlines(a.c[1])}):s.push({tag:"double_quoted",children:this.fromPandocInlines(a.c[1])});break;case"RawInline":s.push({tag:"raw_inline",format:a.c[0],text:a.c[1]});break;case"Code":{const t=i(a.c[0]),e={tag:"verbatim",text:a.c[1]};t&&(e.attributes=t),s.push(e);break}case"Image":case"Link":{let t=i(a.c[0]);a.c[2][1]&&(t=t||{},t.title=a.c[2][1]);const e=a.c[2][0],n=this.fromPandocInlines(a.c[1]);if("Image"===a.t){const i={tag:"image",destination:e,children:n};t&&(i.attributes=t),s.push(i)}else{const i={tag:"link",destination:e,children:n};t&&(i.attributes=t),s.push(i)}break}case"Cite":s.push({tag:"span",attributes:{class:"cite"},children:this.fromPandocInlines(a.c[1])});break;case"Note":{this.footnoteIndex++;const t=this.footnoteIndex.toString(),e=a.c.map((t=>this.fromPandocBlock(t)));this.footnotes[this.footnoteIndex.toString()]={tag:"footnote",label:t,children:e},s.push({tag:"footnote_reference",text:t});break}}}return e.length>0&&s.push({tag:"str",text:e.join("")}),s}fromPandocBlock(t){switch(t.t){case"Plain":case"Para":return{tag:"para",children:this.fromPandocInlines(t.c)};case"BlockQuote":return{tag:"blockquote",children:t.c.map((t=>this.fromPandocBlock(t)))};case"Div":{let e=i(t.c[0]);const s=/\bsection\b/.test(e&&e.class||"")?"section":"div",n=t.c[1].map((t=>this.fromPandocBlock(t)));if("section"===s)return e=e||{},e.class=e.class.replace(/section */,""),e.class||delete e.class,{tag:"section",attributes:e,children:n};{const t={tag:"div",children:n};return e&&(t.attributes=e),t}}case"Header":{const e=i(t.c[1]),s={tag:"heading",level:t.c[0],children:this.fromPandocInlines(t.c[2])};return e&&(s.attributes=e),s}case"HorizontalRule":return{tag:"thematic_break"};case"RawBlock":return{tag:"raw_block",format:t.c[0],text:t.c[1]};case"CodeBlock":{const e=i(t.c[0]);let s;if(e&&e.class){const t=e.class.split(/  */);s=t[0],t.shift(),t.length>0?e.class=t.join(" "):delete e.class}const n={tag:"code_block",lang:s,text:t.c[1]};return e&&(n.attributes=e),s||delete n.lang,n}case"DefinitionList":{const e=[];for(let s=0;s<t.c.length;s++){const n=t.c[s][0],i=t.c[s][1],a=this.fromPandocInlines(n),r=[];for(let t=0;t<i.length;t++)i[t].map((t=>{r.push(this.fromPandocBlock(t))}));e.push({tag:"definition_list_item",children:[{tag:"term",children:a},{tag:"definition",children:r}]})}return{tag:"list",style:":",tight:!1,children:e}}case"OrderedList":case"BulletList":{const e=[];let s,n=!1;s="BulletList"===t.t?t.c:t.c[1];for(let t=0;t<s.length;t++){const i=r(s[t]),a={tag:"list_item",children:s[t].map((t=>("Plain"===t.t?n=!0:"Para"===t.t&&(n=!1),this.fromPandocBlock(t))))};null!==i&&(a.checkbox=i),e.push(a)}if("BulletList"===t.t)return{tag:"list",style:"-",tight:n,children:e};if("OrderedList"===t.t){const s=t.c[0][0];let i;switch(t.c[0][1].t){case"Decimal":default:i="1";break;case"LowerAlpha":i="a";break;case"UpperAlpha":i="A";break;case"LowerRoman":i="i";break;case"UpperRoman":i="I"}switch(t.c[0][2].t){case"Period":default:i+=".";break;case"OneParen":i+=")";break;case"TwoParens":i="("+i+")"}return{tag:"list",style:i,start:s,tight:n,children:e}}}case"Table":{const e=i(t.c[0]),s=t.c[1][1];let n=[];s.length>1||1===s.length&&!a(s[0])?this.warn("Skipping block-level content in table caption."):s[0]&&"c"in s[0]&&(n=this.fromPandocInlines(s[0].c));const r=t.c[2],o=[];for(const t in r)o.push(r[t][0].t.slice(5).toLowerCase());const c=[],l=t.c[3][1];for(const t in l)c.push(this.fromPandocRow(l[t],!0,0,o));const h=t.c[4];for(const t in h){const e=h[t][1],s=h[t][2];for(const t in s)c.push(this.fromPandocRow(s[t],!0,e,o));const n=h[t][3];for(const t in n)c.push(this.fromPandocRow(n[t],!1,e,o))}const d=t.c[5][1];for(const t in d)c.push(this.fromPandocRow(d[t],!1,0,o));const u=c;n.length>0&&u.unshift({tag:"caption",children:n});const p={tag:"table",children:u};return e&&(p.attributes=e),p}case"LineBlock":{const e=[];for(let s=0;s<t.c.length;s++)s>0&&e.push({tag:"hardbreak"}),e.push(...this.fromPandocInlines(t.c[s]));return{tag:"para",children:e}}case"Null":return{tag:"raw_block",format:"none",text:""}}return{tag:"raw_block",format:"error",text:"Could not convert "+t.t}}fromPandocRow(t,e,s,n){const a=i(t[0]),r=t[1],o=[];for(let t=0;t<r.length;t++)o.push(this.fromPandocCell(r[t],e||t<s,n[t]));const c={tag:"row",head:e,children:o};return a&&(c.attributes=a),c}fromPandocCell(t,e,s){let n=[];const r=i(t[0]);let o=t[1].t.slice(5).toLowerCase();"default"===o&&(o=s);const c=t[4];c.length>1||1===c.length&&!a(c[0])?(this.warn("Skipping table cell with block-level content."),n=[{tag:"str",text:"((content omitted))"}]):c[0]&&(n=this.fromPandocInlines(c[0].c));const l={tag:"cell",head:e,align:o,children:n};return r&&(l.attributes=r),l}fromPandoc(t){return t?{tag:"doc",children:t.blocks.map((t=>this.fromPandocBlock(t))),footnotes:this.footnotes,references:{}}:null}parseJSON(t){const e=JSON.parse(t);return this.fromPandoc(e)}}},306:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isInline=e.isCaption=e.isRow=e.isBlock=e.getStringContent=e.renderAST=e.parse=void 0;const n=s(155),i=s(60);Object.defineProperty(e,"isRow",{enumerable:!0,get:function(){return i.isRow}}),Object.defineProperty(e,"isBlock",{enumerable:!0,get:function(){return i.isBlock}}),Object.defineProperty(e,"isCaption",{enumerable:!0,get:function(){return i.isCaption}}),Object.defineProperty(e,"isInline",{enumerable:!0,get:function(){return i.isInline}});const a=function(t){const e=[];return r(t,e),e.join("")};e.getStringContent=a;const r=function(t,e){"text"in t?e.push(t.text):!("tag"in t)||"softbreak"!==t.tag&&"hardbreak"!==t.tag?"children"in t&&t.children.forEach((t=>{r(t,e)})):e.push("\n")},o=function(t){return t.replace(/^ `/,"`").replace(/` $/,"`")},c={i:1,v:5,x:10,l:50,c:100,d:500,m:1e3,I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};var l;!function(t){t[t.Normal=0]="Normal",t[t.Verbatim=1]="Verbatim",t[t.Literal=2]="Literal"}(l||(l={})),e.parse=function(t,e={}){const s=[-1];if(e.sourcePositions)for(let e=0;e<t.length;e++)"\n"===t[e]&&s.push(e);const i=function(t){let e=0,n=s.length-1,i=0,a=0;for(;!i;){const r=e+~~((n-e)/2);s[r]>t?n=r:s[r]<=t&&(r===n||s[r+1]>t?(i=r+1,a=t-s[r]):e=e===r&&e<n?r+1:r)}return{line:i,col:a,offset:t}};let r=l.Normal,h=[];const d={},u={},p={},b={},f=e.warn||function(t,e){console.log(t+(e?" at "+e:"")+"\n")},g=new n.EventParser(t,f),m=function(t){if(Object.keys(b).length>0){t.attributes=t.attributes||{};for(const e in b)t.attributes[e]=b[e],delete b[e]}},k=function(t){const e={children:[],data:{}};t&&(e.pos={start:t.start,end:t.start}),m(e),x.push(e)},_=function(t){const e=x.pop();if(!e)throw new Error("Container stack is empty (popContainer)");return t&&e.pos&&(e.pos.end=t.end),e},N=function(){if(x.length>0)return x[x.length-1];throw new Error("Container stack is empty (topContainer)")},A=function(){const t=N();return t.children.length>0?t.children[t.children.length-1]:t},P=function(t,e){if("attributes"in t&&!t.attributes&&delete t.attributes,x.length>0){const s=x[x.length-1];e&&(t.pos=e),s.children.push(t)}},C={str:(e,s,n,i)=>{const a=t.substring(s,n+1);r===l.Normal?P({tag:"str",text:a},i):h.push(a)},softbreak:(t,e,s,n)=>{r===l.Normal?P({tag:"softbreak"},n):h.push("\n")},escape:(t,e,s,n)=>{r===l.Verbatim&&h.push("\\")},hardbreak:(t,e,s,n)=>{r===l.Normal?P({tag:"hardbreak"},n):h.push("\n")},nbsp:(t,e,s,n)=>{r===l.Verbatim?h.push("\\ "):P({tag:"nbsp"},n)},symbol:(e,s,n,i)=>{if(r===l.Normal){const e=t.substring(s+1,n);P({tag:"symbol",alias:e},i)}else{const e=t.substring(s,n+1);h.push(e)}},footnote_reference:(e,s,n,i)=>{const a=t.substring(s+2,n);P({tag:"footnote_reference",text:a},i)},"+reference_definition":(t,e,s,n)=>{k(n)},"-reference_definition":(t,e,s,n)=>{const i=_(n),a={tag:"reference",label:i.data.key,destination:i.data.value||"",attributes:i.attributes};i.data.key&&(d[i.data.key]=a)},reference_key:(e,s,n,i)=>{N().data.key=t.substring(s+1,n),N().data.value=""},reference_value:(e,s,n,i)=>{N().data.value=N().data.value+t.substring(s,n+1)},"+emph":(t,e,s,n)=>{k(n)},"-emph":(t,e,s,n)=>{const i=_(n);P({tag:"emph",children:i.children},i.pos)},"+strong":(t,e,s,n)=>{k(n)},"-strong":(t,e,s,n)=>{const i=_(n);P({tag:"strong",children:i.children},i.pos)},"+span":(t,e,s,n)=>{k(n)},"-span":(t,e,s,n)=>{const i=_(n);P({tag:"span",children:i.children},i.pos)},"+mark":(t,e,s,n)=>{k(n)},"-mark":(t,e,s,n)=>{const i=_(n);P({tag:"mark",children:i.children},i.pos)},"+superscript":(t,e,s,n)=>{k(n)},"-superscript":(t,e,s,n)=>{const i=_(n);P({tag:"superscript",children:i.children},i.pos)},"+subscript":(t,e,s,n)=>{k(n)},"-subscript":(t,e,s,n)=>{const i=_(n);P({tag:"subscript",children:i.children},i.pos)},"+delete":(t,e,s,n)=>{k(n)},"-delete":(t,e,s,n)=>{const i=_(n);P({tag:"delete",children:i.children},i.pos)},"+insert":(t,e,s,n)=>{k(n)},"-insert":(t,e,s,n)=>{const i=_(n);P({tag:"insert",children:i.children},i.pos)},"+double_quoted":(t,e,s,n)=>{k(n)},"-double_quoted":(t,e,s,n)=>{const i=_(n);P({tag:"double_quoted",children:i.children},i.pos)},"+single_quoted":(t,e,s,n)=>{k(n)},"-single_quoted":(t,e,s,n)=>{const i=_(n);P({tag:"single_quoted",children:i.children},i.pos)},"+attributes":(t,e,s,n)=>{k(n)},"-attributes":(t,e,s,n)=>{const i=_(n);if(i.attributes&&x.length>0){i.attributes.id&&(p[i.attributes.id]=!0);let t=A();if(t===N())return;let s=!1;if("tag"in t&&"str"===t.tag){const e=t.text.match(/[^\s]+$/);if(e&&e.index&&e.index>0){let s;if(t.pos){const n=t.pos.end;t.pos.end={line:n.line,col:n.col-e[0].length,offset:n.offset-e[0].length},s={start:{line:n.line,col:n.col-e[0].length+1,offset:n.offset-e[0].length+1},end:n}}t.text=t.text.substring(0,e.index),P({tag:"str",text:e[0]},s)}else e||(s=!0)}if(t=A(),s)return void f("Ignoring unattached attribute",e);t.attributes||(t.attributes={});for(const e in i.attributes)"class"===e&&t.attributes[e]?t.attributes[e]=t.attributes[e]+" "+i.attributes[e]:t.attributes[e]=i.attributes[e]}},"+block_attributes":(t,e,s,n)=>{k(n)},"-block_attributes":(t,e,s,n)=>{const i=_(n);if(i.attributes&&x.length>0){i.attributes.id&&(p[i.attributes.id]=!0);for(const t in i.attributes)"class"===t&&b[t]?b[t]=b[t]+" "+i.attributes[t]:b[t]=i.attributes[t]}},class:(e,s,n,i)=>{const a=N(),r=t.substring(s,n+1);a.attributes||(a.attributes={}),a.attributes.class?a.attributes.class=a.attributes.class+" "+r:a.attributes.class=r},id:(e,s,n,i)=>{const a=N(),r=t.substring(s,n+1);a.attributes?a.attributes.id=r:a.attributes={id:r}},key:(e,s,n,i)=>{const a=N(),r=t.substring(s,n+1);a.data.key=r,a.attributes||(a.attributes={}),a.attributes[a.data.key]=""},value:(e,s,n,i)=>{const a=N(),r=t.substring(s,n+1).replace(/[ \r\n]+/g," ").replace(/\\(?=[.,\\/#!$%^&*;:{}=\-_`~+[\]()'"?|])/g,"");if(a.attributes||(a.attributes={}),!a.data.key)throw new Error("Encountered value without key");a.attributes[a.data.key]=a.attributes[a.data.key]+r},"+linktext":(t,e,s,n)=>{k(n),N().data.isimage=!1},"-linktext":(t,e,s,n)=>{},"+imagetext":(t,e,s,n)=>{k(n),N().data.isimage=!0},"-imagetext":(t,e,s,n)=>{},"+destination":(t,e,s,n)=>{r=l.Literal},"-destination":(t,e,s,n)=>{const i=_(n);P({tag:i.data.isimage?"image":"link",destination:h.join("").replace(/[\r\n]/g,""),children:i.children},i.pos),r=l.Normal,h=[]},"+reference":(t,e,s,n)=>{r=l.Literal},"-reference":(t,e,s,n)=>{const i=_(n);let o=h.join("").replace(/\r?\n/g," ");0===o.length&&(o=a(i)),P({tag:i.data.isimage?"image":"link",reference:o,children:i.children},i.pos),r=l.Normal,h=[]},"+verbatim":(t,e,s,n)=>{r=l.Verbatim,k(n)},"-verbatim":(t,e,s,n)=>{const i=_(n);P({tag:"verbatim",text:o(h.join(""))},i.pos),r=l.Normal,h=[]},raw_format:(e,s,n,i)=>{const a=t.substring(s,n+1).replace(/^\{?=/,"").replace(/\}$/,""),o=N();if(r===l.Verbatim)o.data.format=a;else{const t=o.children[o.children.length-1];if(!t||!("tag"in t)||"verbatim"!==t.tag)throw new Error("raw_format is not after verbatim or code_block.");t.tag="raw_inline",t.format=a}},"+display_math":(t,e,s,n)=>{r=l.Verbatim,k(n)},"+inline_math":(t,e,s,n)=>{r=l.Verbatim,k(n)},"-display_math":(t,e,s,n)=>{const i=_(n);P({tag:"math",display:!0,text:o(h.join(""))},i.pos),r=l.Normal,h=[]},"-inline_math":(t,e,s,n)=>{const i=_(n);P({tag:"math",display:!1,text:o(h.join(""))},i.pos),r=l.Normal,h=[]},"+url":(t,e,s,n)=>{r=l.Literal,k(n)},"-url":(t,e,s,n)=>{const i=_(n);P({tag:"url",text:h.join("").replace(/[\r\n]/g,"")},i.pos),r=l.Normal,h=[]},"+email":(t,e,s,n)=>{r=l.Literal,k(n)},"-email":(t,e,s,n)=>{const i=_(n);P({tag:"email",text:h.join("").replace(/[\r\n]/g,"")},i.pos),r=l.Normal,h=[]},"+para":(t,e,s,n)=>{k(n)},"-para":(t,e,s,n)=>{const i=_(n);P({tag:"para",children:i.children,attributes:i.attributes},i.pos)},"+heading":(t,e,s,n)=>{k(n),N().data.level=1+s-e},"-heading":(t,e,s,n)=>{const i=_(n);i.attributes||(i.attributes={});const r=a(i).trim();i.attributes.id||(i.attributes.id=function(t){const e=t.trim().replace(/[\W\s.]+/g,"-").replace(/-$/,"").replace(/^-/,"");let s=0,n=e;for(;!n||p[n];)s+=1,n=(e||"s")+"-"+s;return n}(r),p[i.attributes.id]=!0),d[r]||(d[r]={tag:"reference",label:r,destination:"#"+i.attributes.id});let o=N();if(void 0!==o.data.headinglevel){for(;o&&void 0!==o.data.headinglevel&&o.data.headinglevel>=i.data.level;)o=_(n),P({tag:"section",children:o.children,attributes:o.attributes},o.pos),o=N();k(n),N().data.headinglevel=i.data.level,i.attributes&&i.attributes.id&&(N().attributes={id:i.attributes.id},delete i.attributes)}P({tag:"heading",level:i.data.level,children:i.children,attributes:i.attributes},i.pos)},"+list":(t,e,s,n)=>{k(n),N().data.styles=t,N().data.blanklines=!1,N().data.tight=!0},"-list":(t,e,s,n)=>{const i=_(n),a=i.data.styles[0];if(!a)throw new Error("No style defined for list");const r=function(t,e){const s=e.replace(/[().]/g,""),n=t.replace(/[().]/g,"");switch(s){case"1":return parseInt(n,10);case"A":return(n.codePointAt(0)||65)-65+1;case"a":return(n.codePointAt(0)||97)-97+1;case"I":case"i":return function(t){let e=0,s=0,n=t.length-1;for(;n>=0;){const i=t.charAt(n),a=c[i];if(!a)throw new Error("Encountered bad character in roman numeral "+t);a<s?e-=a:e+=a,s=a,n-=1}return e}(n)}}(i.data.firstMarker,a);P({tag:"list",style:a,children:i.children,start:r,tight:i.data.tight,attributes:i.attributes},i.pos)},"+list_item":(e,s,n,i)=>{e.length<N().data.styles.length&&(N().data.styles=e),N().data.firstMarker||(N().data.firstMarker=t.substring(s,n+1)),k(i),1===e.length&&":"===e[0]&&(N().data.definitionList=!0)},"-list_item":(t,e,s,n)=>{const i=_(n);if(i.data.definitionList)if(i.children[0]&&"para"===i.children[0].tag){const t={tag:"term",children:i.children[0].children};i.children.shift();const e={tag:"definition",children:i.children};P({tag:"definition_list_item",children:[t,e],attributes:i.attributes},i.pos)}else{const t={tag:"term",children:[]},e={tag:"definition",children:i.children};P({tag:"definition_list_item",children:[t,e],attributes:i.attributes},i.pos)}else P({tag:"list_item",children:i.children,attributes:i.attributes,checkbox:i.data.checkbox},i.pos)},checkbox_checked:(t,e,s,n)=>{N().data.checkbox="checked"},checkbox_unchecked:(t,e,s,n)=>{N().data.checkbox="unchecked"},"+blockquote":(t,e,s,n)=>{k(n)},"-blockquote":(t,e,s,n)=>{const i=_(n);P({tag:"blockquote",children:i.children,attributes:i.attributes},i.pos)},"+table":(t,e,s,n)=>{k(n),N().data.aligns=[]},"-table":(t,e,s,n)=>{const i=_(n);P({tag:"table",children:i.children,attributes:i.attributes},i.pos)},"+row":(t,e,s,n)=>{k(n),N().data.aligns=[]},"-row":(t,e,s,n)=>{const i=_(n);if(0===i.children.length){N().data.aligns=i.data.aligns;const t=A();if(t&&"tag"in t&&"row"===t.tag){t.head=!0;for(let e=0;e<t.children.length;e++)t.children[e].head=!0,t.children[e].align=i.data.aligns[e]}}else{i.data.aligns=[];for(let t=0;t<i.children.length;t++)i.children[t].align=N().data.aligns[t]||"default";P({tag:"row",children:i.children,head:!1,attributes:i.attributes},i.pos)}},separator_default:(t,e,s,n)=>{N().data.aligns.push("default")},separator_left:(t,e,s,n)=>{N().data.aligns.push("left")},separator_right:(t,e,s,n)=>{N().data.aligns.push("right")},separator_center:(t,e,s,n)=>{N().data.aligns.push("center")},"+cell":(t,e,s,n)=>{k(n)},"-cell":(t,e,s,n)=>{const i=_(n);P({tag:"cell",children:i.children,head:!1,align:"default",attributes:i.attributes},i.pos)},"+caption":(t,e,s,n)=>{k(n)},"-caption":(t,e,s,n)=>{const i=_(n),a=A();!a||"tag"in a&&"table"!==a.tag||a.children.unshift({tag:"caption",children:i.children,attributes:i.attributes,pos:i.pos})},"+footnote":(t,e,s,n)=>{k(n)},"-footnote":(t,e,s,n)=>{const i=_(n);i.data.label?u[i.data.label]={tag:"footnote",label:i.data.label||"",children:i.children,attributes:i.attributes,pos:i.pos}:f("Ignoring footnote without a label.",s)},note_label:(e,s,n,i)=>{N().data.label=t.substring(s,n+1)},"+code_block":(t,e,s,n)=>{k(n),r=l.Verbatim},"-code_block":(t,e,s,n)=>{const i=_(n);i.data.format?P({tag:"raw_block",format:i.data.format,text:h.join(""),attributes:i.attributes},i.pos):P({tag:"code_block",text:h.join(""),lang:i.data.lang,attributes:i.attributes},i.pos),r=l.Normal,h=[]},code_language:(e,s,n,i)=>{N().data.lang=t.substring(s,n+1)},"+div":(t,e,s,n)=>{k(n)},"-div":(t,e,s,n)=>{const i=_(n);P({tag:"div",children:i.children,attributes:i.attributes},i.pos)},thematic_break:(t,e,s,n)=>{const i={tag:"thematic_break"};m(i),P(i,n)},left_single_quote:(t,e,s,n)=>{P({tag:"left_single_quote",text:"'"},n)},right_single_quote:(t,e,s,n)=>{P({tag:"right_single_quote",text:"'"},n)},left_double_quote:(t,e,s,n)=>{P({tag:"left_double_quote",text:'"'},n)},right_double_quote:(t,e,s,n)=>{P({tag:"right_double_quote",text:'"'},n)},ellipses:(t,e,s,n)=>{P({tag:"ellipses",text:"..."},n)},en_dash:(t,e,s,n)=>{P({tag:"en_dash",text:"--"},n)},em_dash:(t,e,s,n)=>{P({tag:"em_dash",text:"---"},n)},blankline:(t,e,s,n)=>{let i;"tight"in N().data?i=N():x.length>=2&&"tight"in x[x.length-2].data&&(i=x[x.length-2]),i&&(i.data.blanklines=!0)}},I=function(t,s){let n,a,r;e.sourcePositions&&(n=i(s.startpos),a=i(s.endpos),r={start:n,end:a});let o=s.annot,c=[];if(s.annot.includes("|")){const t=s.annot.split("|");o=t[0],c=t.slice(1)}if("blankline"!==o){let e;const s=N();s&&(s.data&&"tight"in s.data?e=s:t.length>=2&&"tight"in t[t.length-2].data&&(e=t[t.length-2])),e&&(!/^[+-]list/.test(o)&&e.data.blanklines&&(e.data.tight=!1),/^[-+]list_item$/.test(o)||(e.data.blanklines=!1))}const l=C[o];l&&l(c,s.startpos,s.endpos,r)},x=[{children:[],data:{headinglevel:0},pos:{start:{line:0,col:0,offset:0},end:{line:0,col:0,offset:0}}}];let M,S=0;for(const t of g)I(x,t),S=t.endpos;e.sourcePositions&&(M=i(S));let y=N();for(;y&&y.data.headinglevel>0;)_(M&&{start:M,end:M}),P({tag:"section",children:y.children,attributes:y.attributes},y.pos),y=N();const v={tag:"doc",references:d,footnotes:u,children:x[0].children};return x[0].attributes&&(v.attributes=x[0].attributes),v};const h={children:!0,tag:!0,pos:!0,attributes:!0,references:!0,footnotes:!0},d=function(t){return JSON.stringify(t).replace("\n","n")},u=function(t,e,s){if(e.push(" ".repeat(s)),s>128)e.push("(((DEEPLY NESTED CONTENT OMITTED)))\n");else{e.push(t.tag),t.pos&&e.push(` (${t.pos.start.line}:${t.pos.start.col}:${t.pos.start.offset}-${t.pos.end.line}:${t.pos.end.col}:${t.pos.end.offset})`);for(const s in t)if(!h[s]){const n=t[s];null!=n&&e.push(` ${s}=${d(n)}`)}if(t.attributes)for(const s in t.attributes)e.push(` ${s}=${d(t.attributes[s])}`);e.push("\n"),t.children&&t.children.forEach((t=>{u(t,e,s+2)}))}};e.renderAST=function(t){const e=[];if(u(t,e,0),Object.keys(t.references).length>0){e.push("references\n");for(const s in t.references)e.push(`  [${d(s)}] =\n`),u(t.references[s],e,4)}if(Object.keys(t.footnotes).length>0){e.push("footnotes\n");for(const s in t.footnotes)e.push(`  [${d(s)}] =\n`),u(t.footnotes[s],e,4)}return e.join("")}}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,s),a.exports}var n={};return(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.PandocParser=t.PandocRenderer=t.applyFilter=t.renderAST=t.renderHTML=t.parse=t.EventParser=void 0;const e=s(306);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return e.parse}}),Object.defineProperty(t,"renderAST",{enumerable:!0,get:function(){return e.renderAST}});const i=s(155);Object.defineProperty(t,"EventParser",{enumerable:!0,get:function(){return i.EventParser}});const a=s(240);Object.defineProperty(t,"renderHTML",{enumerable:!0,get:function(){return a.renderHTML}});const r=s(322);Object.defineProperty(t,"applyFilter",{enumerable:!0,get:function(){return r.applyFilter}});const o=s(56);Object.defineProperty(t,"PandocRenderer",{enumerable:!0,get:function(){return o.PandocRenderer}}),Object.defineProperty(t,"PandocParser",{enumerable:!0,get:function(){return o.PandocParser}})})(),n})()));

/*
Copyright (C) 2022 John MacFarlane

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/
